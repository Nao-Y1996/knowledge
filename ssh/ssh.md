# SSH 接続レポート

mac から ubuntu のマシンへの SSH 接続を実施した．

## SSH 接続とは

暗号や認証の技術を利用して，安全にリモートコンピュータと通信するためのプロトコル.

## SSH の認証方式

- **_パスワード認証方式_**  
  接続先のユーザー名とパスワードでログインする.デフォルトでこの方式．
- **_公開鍵認証方式_**  
  公開鍵と秘密鍵の２つの鍵(キーペア)を使用した接続方式．
  サーバーに公開鍵、クライアントに秘密鍵を置いて使用する．
  公開鍵認証を使うとパスワード入力なしで接続（ログイン）できるようになる．

## OpenSSH

Linux にデフォルトで入っている SSH を実現するソフト.  
[OpenSSH](https://www.openssh.com/)

### コマンド

- ssh
  SSH でリモートホストに接続してコマンドを実行する．

```bash
# 秘密鍵を指定して接続する例
ssh username@192.168.0.0 -i ~/.ssh/secretKey
```

- scp  
  SSH を使用してリモートホストとの間でファイルを転送を行う.
- ssh-keygen  
  公開鍵認証方式で使用するキーペアを生成する.
- ssh-copy-id  
  公開鍵をリモートホストに登録するコマンド.
  対話的に保存するディレクトリやパスフレーズを設定できる．
  ここでのパスフレーズはパスワード認証のものとは全く別．

## 公開鍵認証方式の実践

1. **_キーペアの作成_**  
   `ssh-keygen`で任意の場所にキーペアを作成.`-f`オプションで鍵名(ファイル名)を指定できる．以下のコマンドでは keyname（秘密鍵）と keyname.pub（公開鍵）が作成される．

   ```bash
   ssh-keygen -f keyname
   ```

2. **_接続先に公開鍵を登録_**  
   接続先の.ssh/authorized_keys に keyname.pub（公開鍵）の中身をコピーする
   `ssh-copy-id`を使うのが一番楽．コマンドが使えない時は一旦パスワード認証方式で scp を使ってファイルを送り，コピーするなどする．authorized_keys に公開鍵の中身をコピーしたら keyname.pub は消してしまっても動く．

3. **_接続方式を公開鍵認証のみにする_**  
   接続先のマシンでパスワード認証を false にして公開鍵認証を ture にする
   /etc/ssh/sshd_config を以下になるように編集する.
   以降，パスワード入力せずに接続できる（pubkey のパスフレーズを設定しているとそれが聞かれる）．

   ```text
   PasswordAuthentication no

   PubkeyAuthentication yes
   ```
